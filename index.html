<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maghreb Truck Company SPA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            height: 100vh;
            background: #000;
        }

        /* Background avec l'image du camion */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('./Capture.PNG');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
            filter: blur(3px);
            transform: scale(1.1);
        }

        /* Overlay pour assombrir l√©g√®rement l'arri√®re-plan */
        .background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 2;
        }

        /* Header */
        .header {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 10;
        }

        .header h1 {
            color: white;
            font-size: 3rem;
            font-weight: 900;
            text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.8);
            letter-spacing: 2px;
        }

        /* Container principal */
        .main-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 100px 50px 50px;
            z-index: 5;
        }

        /* Section Avatar 3D - AGRANDI */
        .avatar-container {
            width: 60%;
            height: 85vh;
            position: relative;
            z-index: 6;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 2%;
        }

        #canvas {
            width: 100% !important;
            height: 100% !important;
            display: block;
            filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.5));
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 25px 50px;
            border-radius: 20px;
            font-size: 1.3rem;
            text-align: center;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            animation: spin 1s linear infinite;
            margin: 15px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Bulle de chat - R√âDUITE */
        .chat-bubble {
            width: 35%;
            min-height: 550px;
            max-height: 70vh;
            background: rgba(59, 130, 246, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.2) inset;
            position: relative;
            z-index: 7;
            border: 1px solid rgba(255, 255, 255, 0.18);
            display: flex;
            flex-direction: column;
            margin-right: 2%;
        }

        /* Fl√®che de la bulle pointant vers l'avatar */
        .chat-bubble::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 25px solid transparent;
            border-bottom: 25px solid transparent;
            border-right: 25px solid rgba(59, 130, 246, 0.9);
            filter: drop-shadow(-2px 0 5px rgba(0, 0, 0, 0.2));
        }

        .chat-bubble h2 {
            color: white;
            font-size: 1.3rem;
            line-height: 1.6;
            margin-bottom: 20px;
            font-weight: 400;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Boutons d'action */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .action-btn {
            padding: 15px 25px;
            background: rgba(30, 64, 175, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 14px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
        }

        .action-btn:hover {
            background: rgba(30, 64, 175, 1);
            transform: translateX(5px);
            box-shadow: 0 6px 25px rgba(30, 64, 175, 0.5);
        }

        /* Zone de messages */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 18px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-height: 350px;
        }

        .messages-container.active {
            display: block;
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        .message {
            margin-bottom: 12px;
            padding: 12px 16px;
            border-radius: 12px;
            animation: slideIn 0.4s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            word-wrap: break-word;
            font-size: 0.95rem;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            background: rgba(30, 64, 175, 0.95);
            color: white;
            margin-left: 15%;
            backdrop-filter: blur(10px);
        }

        .message.assistant {
            background: rgba(255, 255, 255, 0.98);
            color: #1e293b;
            margin-right: 15%;
            backdrop-filter: blur(10px);
        }

        .message.typing {
            background: rgba(255, 255, 255, 0.8);
            color: #64748b;
            font-style: italic;
        }

        /* Input de chat */
        .chat-input-container {
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 8px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        #userInput {
            flex: 1;
            padding: 12px 18px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            outline: none;
            color: #1e293b;
            background: transparent;
        }

        #userInput::placeholder {
            color: #94a3b8;
        }

        #sendBtn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(30, 64, 175, 0.4);
        }

        #sendBtn:hover {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e293b 100%);
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(30, 64, 175, 0.6);
        }

        #sendBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: scale(1);
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .header h1 {
                font-size: 2.5rem;
            }

            .chat-bubble {
                padding: 25px;
            }

            .avatar-container {
                width: 55%;
            }

            .chat-bubble {
                width: 40%;
            }
        }

        @media (max-width: 1200px) {
            .main-container {
                padding: 100px 30px 30px;
            }

            .avatar-container {
                width: 50%;
            }

            .chat-bubble {
                width: 45%;
            }
        }

        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
                justify-content: flex-start;
                gap: 30px;
                padding-top: 120px;
                height: auto;
                min-height: 100vh;
            }

            .avatar-container {
                width: 80%;
                height: 450px;
                margin-bottom: 20px;
                margin-left: 0;
            }

            .chat-bubble {
                width: 85%;
                min-height: 500px;
                margin-bottom: 30px;
                margin-right: 0;
                max-height: 60vh;
            }

            .chat-bubble::before {
                display: none;
            }

            .header h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 100px 20px 20px;
            }

            .chat-bubble {
                width: 95%;
                padding: 20px;
                min-height: 450px;
            }

            .avatar-container {
                width: 95%;
                height: 350px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .chat-bubble h2 {
                font-size: 1.2rem;
            }
        }
    </style>
</head>

<body>
    <!-- Background avec image du camion -->
    <div class="background"></div>

    <!-- Header -->
    <div class="header">
        <h1>MAGHREB TRUCK COMPANY SPA</h1>
    </div>

    <!-- Container principal -->
    <div class="main-container">
        <!-- Avatar 3D - AGRANDI -->
        <div class="avatar-container">
            <div id="loading">
                <div class="spinner"></div>
                Chargement de l'avatar...
            </div>
            <canvas id="canvas"></canvas>
        </div>

        <!-- Bulle de chat - R√âDUITE -->
        <div class="chat-bubble" id="chatBubble">
            <h2>Hello! I'm AiMan, MTC Assistant. I'm available 24/7 to answer your questions about our company.</h2>

            <div class="messages-container" id="messagesContainer"></div>

            <div class="action-buttons" id="actionButtons">
                <button class="action-btn" onclick="quickQuestion('Present MTC SPA to me! ')">
                    Present MTC SPA to me!
                </button>

                <button class="action-btn" onclick="quickQuestion('Contacts ! ')">
                    Contacts !
                </button>
            </div>

            <div class="chat-input-container">
                <input type="text" id="userInput" placeholder="Posez votre question ici..."
                    onkeypress="handleKeyPress(event)">
                <button id="sendBtn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>

    <script>
        let model = null;
        let isTyping = false;
        let baseYPosition = 0;


        // Base de connaissances MTC SPA - Version am√©lior√©e
        const mtcKnowledgeBase = {
            "contact": {
                question: "Contact MTC",
                r√©ponse: `<p><strong>üìû MTC Algiers Contacts:</strong></p>
    
            <div style="margin: 8px 0;">
                   <strong> Commercial Service</strong><br>
                   <a href="tel:023-450290 / 023-450965 / 023-450966" style="color: #1e40af;">023-450290 / 023-450965 / 023-450966</a><br>
                   <a href="mailto:service.commercial@mtc-man.com" style="color: #1e40af;">service.commercial@mtc-man.com</a>
            </div>

    <div style="margin: 8px 0;">
        <strong> After-Sales Service</strong><br>
        <a href="tel: 023-450970" style="color: #1e40af;">023-450970</a><br>
        <a href="mailto:sav@mtc-man.com" style="color: #1e40af;">sav@mtc-man.com</a>
    </div>

    <div style="margin: 8px 0;">
        <strong> Spare Parts</strong><br>
        <a href="tel:023-450957 / 023-450968 / 023-450982" style="color: #1e40af;">023-450957 / 023-450968 / 023-450982</a><br>
        <a href="mailto:pdr@mtc-man.com" style="color: #1e40af;">pdr@mtc-man.com</a>
    </div>

    <div style="margin: 8px 0;">
        <strong> Marketing Service</strong><br>
        <a href="tel:023-450957 / 023-450968 / 023-450982" style="color: #1e40af;">023-450957 / 023-450968 / 023-450982</a><br>
        <a href="mailto:mehdi.laroui@mtc-man.com" style="color: #1e40af;">mehdi.laroui@mtc-man.com</a>
    </div>

    <p><strong>üåê Website:</strong> <a href="https://mtc-man.com" target="_blank" style="color: #1e40af;">https://mtc-man.com</a></p>
   `,
            },
            "presentation": {
                question: "MTC Presentation",
                r√©ponse: `<p><strong>MTC (Maghreb Truck Company)</strong> is the exclusive dealer of MAN Truck & Bus in Algeria.</p>
        <p>With <strong>over 15 years of experience</strong>, MTC offers complete solutions for goods and passenger transport with an extensive range of MAN industrial vehicles.</p>`
            },

            "price_truck": {
                question: "What is the price of this MAN truck?",
                r√©ponse: `<p><strong>Prices vary by configuration. I can help you choose the right model and provide an indicative offer before our sales team contacts you.</p>
        `
            },

            "model_available": {
                question: "Do you have this model available in stock?",
                r√©ponse: `<p><strong> I can check the current availability and show you the closest equivalent models if stock is limited.</p>
        `
            },

            "delivery": {
                question: "How long is the delivery time for a new truck?",
                r√©ponse: `<p><strong>Delivery time depends on configuration and production schedule. On average, it ranges from 6 to 14 weeks.</strong></p>`
            },

            "right_trucks": {
                question: "Can you help me choose the right truck for my operation?",
                r√©ponse: `<p><strong>Absolutely. Tell me your load, route type, and annual mileage, and I will recommend the best MAN configuration.</strong></p>
        
        `,

            },

            "warning": {
                question: "My truck has a warning light on, what should I do?",
                r√©ponse: `<p><strong> I can help identify the meaning of the warning light and guide you step-by-step. If needed, I‚Äôll help you book a workshop appointment.</strong></p>
        
        `,

            },

            "workshop": {
                question: "Where is the nearest MTC workshop?",
                r√©ponse: `<p><strong> I can locate the closest MAN/MTC service point and provide directions, contact, and opening hours.</strong></p>
        
        `,

            },

            "maitenance": {
                question: "How much does preventive maintenance cost?",
                r√©ponse: `<p><strong> I can estimate maintenance costs based on your model, mileage, and operation type.</strong></p>
        
        `,


            },

            "spare_part": {
                question: "Do you have the spare part I need?",
                r√©ponse: `<p><strong>Tell me the part number or describe the component, and I will check availability and alternatives.</strong></p>
        
       `,


            },

            "track_fleet": {
                question: "Can I track my truck or fleet with you?",
                r√©ponse: `<p><strong> Yes. I provide access to fleet data, tracking status, and performance insights depending on your connected services.</strong></p>
        
        `,

            },

            "warranty_MAN": {
                question: "What warranty do MAN trucks have?",
                r√©ponse: `<p><strong>Standard warranty is 1 year, extendable depending on model and usage. I can provide details for your exact vehicle.</strong></p>
    
           
   `,

            },

            "financing_options": {
                question: "Can you help me with financing options?",
                r√©ponse: `<p><strong> Yes. I can provide financing simulations and guide you toward the best plan based on your business.</strong></p>
    
           
   `,

            },
            "training": {
                question: "Do you offer driver training?",
                r√©ponse: `<p><strong>  Yes. MTC offers MAN-approved driver training programs. I can schedule a session for your drivers.</strong></p>
    
           
   `,

            },

            "prix_camion": {
                question: "Quel est le prix de ce camion MAN ?",
                r√©ponse: `<p><strong>  Le prix d√©pend de la configuration. Je peux vous proposer une estimation et vous orienter vers un commercial.</strong></p>
    
           
   `,

            },
            "modele_stock": {
                question: "‚ÄúAvez-vous ce mod√®le en stock ?",
                r√©ponse: `<p><strong>  Je v√©rifie imm√©diatement la disponibilit√© et je peux vous proposer des mod√®les √©quivalents en cas de rupture.</strong></p>
    
           
   `,

            },
            "delai_livraison": {
                question: "‚ÄúQuel est le d√©lai de livraison pour un nouveau camion ?",
                r√©ponse: `<p><strong>   Le d√©lai d√©pend de la configuration et du planning de production. En moyenne entre 6 et 14 semaines.</strong></p>
    
           
   `,

            },
            "bon_camion": {
                question: "‚ÄúPouvez-vous m‚Äôaider √† choisir le bon camion pour mon activit√© ?",
                r√©ponse: `<p><strong> Oui. Donnez-moi le type de charge, votre parcours et le kilom√©trage annuel, et je vous propose la meilleure configuration MAN.</strong></p>
    
           
   `,

            },

            "aide": {
                question: "‚ÄúJ‚Äôai un voyant qui s‚Äôallume, que dois-je faire ?",
                r√©ponse: `<p><strong> Je peux identifier le voyant et vous guider. Si n√©cessaire, je r√©serve un passage atelier pour vous.</strong></p>
    
           
   `,

            },
            "mtc_proche": {
                question: "‚ÄúO√π se trouve l‚Äôatelier MTC le plus proche ?",
                r√©ponse: `<p><strong>Je vous donne l‚Äôadresse, les horaires et le num√©ro du point de service le plus proche.</strong></p>
    
           
   `,

            },
            "maitennance": {
                question: "‚ÄúCombien co√ªte une maintenance pr√©ventive ?",
                r√©ponse: `<p><strong>Je peux estimer le co√ªt en fonction du mod√®le, du kilom√©trage et de votre utilisation.</strong></p>
    
           
   `,

            },

            "piece_rechange": {
                question: "‚ÄúAvez-vous la pi√®ce de rechange dont j‚Äôai besoin ?",
                r√©ponse: `<p><strong> Indiquez-moi la r√©f√©rence ou d√©crivez la pi√®ce, et je v√©rifie imm√©diatement le stock.</strong></p>
    
           
   `,

            },
            "suivre_camion": {
                question: "‚ÄúPuis-je suivre mon camion ou ma flotte avec vous ?",
                r√©ponse: `<p><strong>Oui. Je peux vous donner les donn√©es de suivi, la position et les performances (selon les services connect√©s).</strong></p>
    
           
   `,

            },

            "garantie_camion": {
                question: "‚ÄúQuelle est la garantie des camions MAN ?",
                r√©ponse: `<p><strong>La garantie standard est d‚Äôun an, avec des options d‚Äôextension selon le mod√®le.</strong></p>
    
           
   `,

            },

            "aide_financement": {
                question: "‚ÄúPouvez-vous m‚Äôaider pour le financement ?",
                r√©ponse: `<p><strong> Oui. Je peux vous proposer des simulations et vous orienter vers la meilleure solution.</strong></p>
    
           
   `,

            },

            "formations": {
                question: "‚ÄúProposez-vous des formations conducteurs ?",
                r√©ponse: `<p><strong>Oui. MTC propose des formations MAN certifi√©es. Je peux organiser une session pour vos chauffeurs.</strong></p>
    
           
   `,

            },






        };


        // Initialisation de la sc√®ne 3D

        window.addEventListener('load', function () {
            const scene = new THREE.Scene();
            scene.background = null;

            const canvas = document.getElementById('canvas');
            const container = document.querySelector('.avatar-container');

            const camera = new THREE.PerspectiveCamera(
                45,
                container.offsetWidth / container.offsetHeight,
                0.1,
                1000
            );

            // Cam√©ra recul√©e pour voir l'avatar agrandi
            camera.position.set(0, 1.0, 3.5);
            camera.lookAt(0, 0.8, 0);

            const renderer = new THREE.WebGLRenderer({
                canvas: canvas,
                antialias: true,
                alpha: true
            });

            renderer.setSize(container.offsetWidth, container.offsetHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            // √âclairage renforc√© pour l'avatar agrandi
            const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.8);
            directionalLight.position.set(5, 10, 7);
            scene.add(directionalLight);

            const fillLight = new THREE.DirectionalLight(0x3b82f6, 1.0);
            fillLight.position.set(-5, 5, -5);
            scene.add(fillLight);

            // Lumi√®re suppl√©mentaire pour mieux voir l'avatar agrandi
            const rimLight = new THREE.DirectionalLight(0xffffff, 0.8);
            rimLight.position.set(0, 5, -5);
            scene.add(rimLight);

            // Charger l'avatar
            const loader = new THREE.GLTFLoader();
            const avatarUrl = 'https://raw.githubusercontent.com/asmabrn/avatar-3/main/test.glb';


            loader.load(
                avatarUrl,
                function (gltf) {
                    console.log("‚úÖ Avatar charg√© avec succ√®s!");
                    document.getElementById('loading').style.display = 'none';

                    model = gltf.scene;

                    const box = new THREE.Box3().setFromObject(model);
                    const size = box.getSize(new THREE.Vector3());
                    const center = box.getCenter(new THREE.Vector3());

                    // Ajustement pour centrer l'avatar
                    model.position.x = -center.x;
                    model.position.y = -center.y - 0.9; // Position ajust√©e
                    model.position.z = -center.z;

                    // Stocker la position Y de base
                    baseYPosition = model.position.y;

                    // √âchelle AUGMENT√âE pour avatar plus grand
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const scale = 3.8 / maxDim; // Augment√© de 2.8 √† 3.8
                    model.scale.set(scale, scale, scale);

                    scene.add(model);

                    let mixer = null;
                    const clock = new THREE.Clock();

                    if (gltf.animations && gltf.animations.length > 0) {
                        mixer = new THREE.AnimationMixer(model);
                        gltf.animations.forEach((clip) => {
                            mixer.clipAction(clip).play();
                        });
                    }

                    function animate() {
                        requestAnimationFrame(animate);
                        const delta = clock.getDelta();

                        if (mixer) {
                            mixer.update(delta);
                        } else {
                            model.rotation.y += 0.003;
                        }

                        // Animation quand il parle - seulement rotation
                        if (isTyping && model) {
                            const time = Date.now() * 0.001;
                            model.rotation.y = Math.sin(time) * 0.1;
                            model.position.y = baseYPosition;
                        } else if (model) {
                            model.position.y = baseYPosition;
                        }

                        renderer.render(scene, camera);
                    }
                    animate();

                    // Redimensionnement responsive
                    window.addEventListener('resize', function () {
                        const newWidth = container.offsetWidth;
                        const newHeight = container.offsetHeight;

                        camera.aspect = newWidth / newHeight;
                        camera.updateProjectionMatrix();
                        renderer.setSize(newWidth, newHeight);
                    });
                },
                function (progress) {
                    const percent = (progress.loaded / progress.total * 100) || 0;
                    document.getElementById('loading').innerHTML =
                        `<div class="spinner"></div>Chargement: ${Math.round(percent)}%`;
                },
                function (error) {
                    console.error('‚ùå Erreur de chargement:', error);
                    document.getElementById('loading').innerHTML =
                        '<span style="color: #ff6b6b;">‚ùå Erreur de chargement</span><br><small>V√©rifiez la console</small>';

                    // Cr√©er un avatar de secours AGRANDI
                    createFallbackAvatar(scene, renderer, camera, container);
                }
            );
        });

        // Fonction pour cr√©er un avatar de secours AGRANDI
        function createFallbackAvatar(scene, renderer, camera, container) {
            // Corps AGRANDI
            const bodyGeometry = new THREE.CapsuleGeometry(0.7, 1.4, 4, 8);
            const bodyMaterial = new THREE.MeshPhongMaterial({
                color: 0x3498db,
                shininess: 30
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.4;
            scene.add(body);

            // T√™te AGRANDIE
            const headGeometry = new THREE.SphereGeometry(0.4, 16, 16);
            const headMaterial = new THREE.MeshPhongMaterial({
                color: 0xf1c27d
            });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.3;
            scene.add(head);

            // Yeux AGRANDIS
            const eyeGeometry = new THREE.SphereGeometry(0.07, 8, 8);
            const eyeMaterial = new THREE.MeshPhongMaterial({ color: 0x000000 });

            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(-0.12, 1.35, 0.3);
            scene.add(leftEye);

            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.12, 1.35, 0.3);
            scene.add(rightEye);

            model = new THREE.Group();
            model.add(body, head, leftEye, rightEye);

            // Stocker la position de base
            baseYPosition = model.position.y;

            // Animation de secours sans mouvement vertical
            function animate() {
                requestAnimationFrame(animate);
                model.rotation.y += 0.01;
                model.position.y = baseYPosition;
                renderer.render(scene, camera);
            }
            animate();

            console.log("‚úÖ Avatar de secours cr√©√© (version agrandie)");
        }

        // Fonction pour obtenir une r√©ponse bas√©e sur la base de connaissances
        function getResponse(message) {
            const lowerMessage = message.toLowerCase();

            // Search in knowledge base
            
            if (lowerMessage.includes('present') ) {
                return mtcKnowledgeBase.presentation.r√©ponse;
            }else if(lowerMessage.includes('price')) {
                return mtcKnowledgeBase.price_truck.r√©ponse;
            } else if (lowerMessage.includes('model') || lowerMessage.includes('available')) {
                return mtcKnowledgeBase.model_available.r√©ponse;
            } else if (lowerMessage.includes('delivery')) {
                return mtcKnowledgeBase.delivery.r√©ponse;
            } else if (lowerMessage.includes('right truck') || lowerMessage.includes('operation')) {
                return mtcKnowledgeBase.right_trucks.r√©ponse;
            } else if (lowerMessage.includes('warning light')) {
                return mtcKnowledgeBase.warning.r√©ponse;
            } else if (lowerMessage.includes('nearest') || lowerMessage.includes('workshop')) {
                return mtcKnowledgeBase.workshop.r√©ponse;
            } else if (lowerMessage.includes('preventive maitennance')) {
                return mtcKnowledgeBase.maitenance.r√©ponse;
            } else if (lowerMessage.includes('spare') || lowerMessage.includes('part')) {
                return mtcKnowledgeBase.spare_part.r√©ponse;
            } else if (lowerMessage.includes('track') || lowerMessage.includes('fleet')) {
                return mtcKnowledgeBase.track_fleet.r√©ponse;
            } else if (lowerMessage.includes('warranty')) {
                return mtcKnowledgeBase.warranty_MAN.r√©ponse;
            } else if (lowerMessage.includes('financing ')) {
                return mtcKnowledgeBase.financing_options.r√©ponse;
            } else if (lowerMessage.includes('training')) {
                return mtcKnowledgeBase.training.r√©ponse;
            } else if (lowerMessage.includes('prix')) {
                return mtcKnowledgeBase.prix_camion.r√©ponse;
            } else if (lowerMessage.includes('mod√®le')) {
                return mtcKnowledgeBase.modele_stock.r√©ponse;
            } else if (lowerMessage.includes('d√©lai') || lowerMessage.includes('livraison')) {
                return mtcKnowledgeBase.delai_livraison.r√©ponse;

            } else if (lowerMessage.includes('bon') || lowerMessage.includes('activit√©')) {
                return mtcKnowledgeBase.bon_camion.r√©ponse;
            } else if (lowerMessage.includes('voyant')) {
                return mtcKnowledgeBase.aide.r√©ponse;
            } else if (lowerMessage.includes('atelier') || lowerMessage.includes('proche')) {
                return mtcKnowledgeBase.mtc_proche.r√©ponse;
            } else if (lowerMessage.includes(' maintenance pr√©ventive')) {
                return mtcKnowledgeBase.maitennance.r√©ponse;
            } else if (lowerMessage.includes('pi√®ce de rechange')) {
                return mtcKnowledgeBase.piece_rechange.r√©ponse;
            } else if (lowerMessage.includes('suivre') || lowerMessage.includes('flotte')) {
                return mtcKnowledgeBase.suivre_camion.r√©ponse;
            } else if (lowerMessage.includes('garantie')) {
                return mtcKnowledgeBase.garantie_camion.r√©ponse;
            } else if (lowerMessage.includes('aide') || lowerMessage.includes('financement')) {
                return mtcKnowledgeBase.aide_financement.r√©ponse;
            } else if (lowerMessage.includes('formations')) {
                return mtcKnowledgeBase.formations.r√©ponse;
            } else if (lowerMessage.includes('contact') || lowerMessage.includes('coordinate')) {
                return mtcKnowledgeBase.contact.r√©ponse;
            } else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('good morning') || lowerMessage.includes('hey')) {
                return "Hello! I'm AiMan, MTC's digital expert specialized in MAN solutions. How can I help you today?";
            } else if (lowerMessage.includes('thank') || lowerMessage.includes('thanks') || lowerMessage.includes('merci')) {
                return "You're welcome! Don't hesitate if you have other questions about MTC and our MAN services. üòä";
            } else {
                return "I'm sorry, I didn't quite understand your question. I'm MATIC, MTC's expert in MAN solutions. My areas of expertiseare : missions , vision , sales , spare parts ,After-Sales,locations in Algeria\n\nWhich aspect of our  expertise can I advise you on?";
            }
            
        }
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();

            if (!message) return;

            const messagesContainer = document.getElementById('messagesContainer');
            const actionButtons = document.getElementById('actionButtons');

            // Masquer les boutons d'action quand la conversation commence
            actionButtons.style.display = 'none';

            messagesContainer.classList.add('active');

            addMessage(message, 'user');
            input.value = '';

            document.getElementById('sendBtn').disabled = true;
            isTyping = true;

            addMessage('Typing...', 'typing', 'typing-msg');

            try {
                // Simulation d'une r√©ponse
                setTimeout(() => {
                    document.getElementById('typing-msg')?.remove();

                    let response = getResponse(message);

                    addMessage(response, 'assistant');
                    document.getElementById('sendBtn').disabled = false;
                    isTyping = false;
                }, 1500);

            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('typing-msg')?.remove();
                addMessage("D√©sol√©, une erreur s'est produite. Veuillez r√©essayer.", 'assistant');
                document.getElementById('sendBtn').disabled = false;
                isTyping = false;
            }
        }

        function addMessage(text, type, id = null) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            if (id) messageDiv.id = id;

            if (type === 'assistant') {
                // Pour l'assistant, on permet le HTML
                messageDiv.innerHTML = text;

                // Ajouter les fichiers si pr√©sents dans la r√©ponse
                const currentResponse = getCurrentResponse(text);
                if (currentResponse && currentResponse.fichiers) {
                    const fichiersContainer = document.createElement('div');
                    fichiersContainer.className = 'fichiers-container';
                    fichiersContainer.style.marginTop = '10px';
                    fichiersContainer.style.padding = '10px';
                    fichiersContainer.style.background = 'rgba(255,255,255,0.1)';
                    fichiersContainer.style.borderRadius = '8px';

                    const titreFichiers = document.createElement('p');
                    titreFichiers.innerHTML = '<strong>üìé Fichiers disponibles :</strong>';
                    fichiersContainer.appendChild(titreFichiers);

                    currentResponse.fichiers.forEach(fichier => {
                        const lienFichier = document.createElement('a');
                        lienFichier.href = fichier.url;
                        lienFichier.target = '_blank';
                        lienFichier.style.display = 'block';
                        lienFichier.style.padding = '8px';
                        lienFichier.style.margin = '5px 0';
                        lienFichier.style.background = 'rgba(59, 130, 246, 0.8)';
                        lienFichier.style.borderRadius = '6px';
                        lienFichier.style.color = 'white';
                        lienFichier.style.textDecoration = 'none';
                        lienFichier.innerHTML = `${fichier.titre} <small style="opacity: 0.8;">- ${fichier.description}</small>`;

                        fichiersContainer.appendChild(lienFichier);
                    });

                    messageDiv.appendChild(fichiersContainer);
                }
            } else {
                // Pour l'utilisateur, on garde le texte simple
                messageDiv.textContent = text;
            }

            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Fonction utilitaire pour retrouver la r√©ponse actuelle
        function getCurrentResponse(text) {
            // Cette fonction devrait √™tre adapt√©e selon votre structure
            // Pour l'instant, retourne null - √† adapter selon vos besoins
            return null;
        }

        function quickQuestion(question) {
            document.getElementById('userInput').value = question;
            sendMessage();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
    </script>
</body>

</html>